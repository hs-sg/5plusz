<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8" trimDirectiveWhitespaces="true"%>
<%@ taglib prefix="c" uri="jakarta.tags.core"%>

<!-- Bootstrap Icons CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

<!-- ì‚¬ìš©ì ì •ì˜ í–„ë²„ê±° ì•„ì´ì½˜ ë° ë²„íŠ¼ ìŠ¤íƒ€ì¼ -->
<style>
    /* ë²„íŠ¼ ìì²´ì˜ ë°°ê²½ê³¼ í…Œë‘ë¦¬ë¥¼ ì œê±° */
    .btn-hamburger {
        background-color: transparent !important;
        border: none !important;
        padding: 0;
    }
    /* ì‚¬ìš©ì ì •ì˜ í–„ë²„ê±° ì•„ì´ì½˜: ì„¸ ê°œì˜ ê²€ì€ìƒ‰ ê°€ë¡œì¤„ */
    .custom-toggler-icon {
        display: inline-block;
        width: 30px;
        height: 24px;
        position: relative;
    }
    .custom-toggler-icon span {
        display: block;
        position: absolute;
        height: 3px;
        width: 100%;
        background: #000;
        border-radius: 2px;
        left: 0;
        transition: all 0.2s;
    }
    .custom-toggler-icon span:nth-child(1) { top: 0; }
    .custom-toggler-icon span:nth-child(2) { top: 10px; }
    .custom-toggler-icon span:nth-child(3) { top: 20px; }

    /* ì•Œë¦¼ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    .btn-notification {
        background-color: transparent !important;
        border: none !important;
        padding: 0;
        margin-right: 1rem;
        position: relative;
        transition: transform 0.2s;
    }
    
    .btn-notification:hover {
        transform: scale(1.1);
    }
    
    .notification-badge {
        position: absolute;
        top: -5px;
        right: -5px;
        background-color: #dc3545;
        color: white;
        border-radius: 50%;
        padding: 0.25rem 0.5rem;
        font-size: 0.75rem;
        display: none;
    }

    /* ì•Œë¦¼ í•„í„° ìŠ¤íƒ€ì¼ */
    .notification-filters {
        display: flex;
        gap: 0.5rem;
        margin-bottom: 1rem;
        padding: 0.5rem;
        border-bottom: 1px solid #dee2e6;
    }

    .filter-btn {
        padding: 0.25rem 0.75rem;
        border-radius: 15px;
        border: 1px solid #dee2e6;
        background: white;
        font-size: 0.875rem;
        transition: all 0.2s;
    }

    .filter-btn.active {
        background: #0d6efd;
        color: white;
        border-color: #0d6efd;
    }

    /* ë¹ˆ ìƒíƒœ ìŠ¤íƒ€ì¼ */
    .empty-state {
        text-align: center;
        padding: 2rem;
        color: #6c757d;
    }

    .empty-state-icon {
        font-size: 3rem;
        margin-bottom: 1rem;
        color: #dee2e6;
    }
</style>

<!-- Header -->
<!-- Header: ì™¼ìª½ì— Fest Go, ì˜¤ë¥¸ìª½ì— ì•Œë¦¼ê³¼ í–„ë²„ê±° ë©”ë‰´ ë²„íŠ¼ -->
<header class="p-3" style="background-color: transparent;">
    <div class="container-fluid d-flex justify-content-between align-items-center">
        <!-- ì™¼ìª½: ë¡œê³  í…ìŠ¤íŠ¸ -->
        <div>
            <c:url value="/" var="homePage"/>
            <a href="${homePage}" class="text-dark text-decoration-none" 
               style="font-size: 2.5rem; font-weight: bold;">
                ğŸ…µğŸ…´ğŸ†‚ğŸ†ƒ ğŸ…¶ğŸ…¾
            </a>
        </div>
        <!-- ì˜¤ë¥¸ìª½: ì•Œë¦¼ ë²„íŠ¼ê³¼ í–„ë²„ê±° ë©”ë‰´ ë²„íŠ¼ì„ í¬í•¨í•˜ëŠ” div -->
        <div class="d-flex align-items-center">
            <!-- ì•Œë¦¼ ë²„íŠ¼ -->
            <c:if test="${not empty signedInUser}">
                <button class="btn btn-notification me-3" type="button"
                        data-bs-toggle="modal" data-bs-target="#notificationModal">
                    <i class="bi bi-bell fs-4"></i>
                    <span class="notification-badge" id="notificationBadge" style="display: block;">
                        <c:out value="${notificationCount}" default="0"/>
                    </span>
                </button>
            </c:if>
            <!-- í–„ë²„ê±° ë©”ë‰´ ë²„íŠ¼ -->
            <button class="btn btn-hamburger" type="button"
                    data-bs-toggle="offcanvas" data-bs-target="#offcanvasMenu"
                    aria-controls="offcanvasMenu">
                <span class="custom-toggler-icon">
                    <span></span>
                    <span></span>
                    <span></span>
                </span>
            </button>
        </div>
    </div>
</header>

<!-- Offcanvas ë©”ë‰´ (ì˜¤ë¥¸ìª½ì—ì„œ ìŠ¬ë¼ì´ë“œ) -->
<div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasMenu" aria-labelledby="offcanvasMenuLabel">
    <div class="offcanvas-header">
        <c:if test="${ empty signedInUser }">
            <h5 class="offcanvas-title" id="offcanvasMenuLabel">Menu</h5>
        </c:if>
        <c:if test="${ not empty signedInUser }">
            <h5 class="offcanvas-title" id="offcanvasMenuId">ì•ˆë…•í•˜ì„¸ìš”! ${signedInUser }ë‹˜</h5>
        </c:if>
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body">
        <!-- ë‚´ë¹„ê²Œì´ì…˜ í•­ëª© ì „ì²´ -->
        <ul class="nav flex-column">
            <li class="nav-item">
                <c:url value="/" var="homePage"/>
                <a class="nav-link" href="${homePage}">ì „êµ­ì¶•ì œ</a>
            </li>
            <li class="nav-item">
                <c:url value="/fest/cal" var="festCal"/>
                <a class="nav-link" href="${festCal}">ì¶•ì œë‹¬ë ¥</a>
            </li>
            <li class="nav-item">
                <c:url value="/post/list" var="postList"/>
                <a class="nav-link" href="${postList}">ì»¤ë®¤ë‹ˆí‹°</a>
            </li>
            <c:if test="${memberRole eq 2 || memberRole eq 3}">
                <li class="nav-item">
                    <c:url value="/fest/create" var="festCreate"/>
                    <a class="nav-link" href="${festCreate}">ì¶•ì œë“±ë¡</a>
                </li>
            </c:if>
            <!-- ë¡œê·¸ì¸ ìƒíƒœì— ë”°ë¥¸ ë©”ë‰´ í•­ëª© -->
            <c:if test="${empty signedInUser}">
                <li class="nav-item">
                    <a class="nav-link" href="" id="linkSignin">LOGIN</a>
                </li>
                <li class="nav-item">
                    <c:url value="/user/signup" var="signUpPage"/>
                    <a class="nav-link" href="${signUpPage}">SIGNUP</a>
                </li>
            </c:if>
            <c:if test="${not empty signedInUser}">
                <li class="nav-item">
                    <c:url value="/user/mypage" var="myPage"/>
                    <a class="nav-link" href="${myPage}">ë§ˆì´í˜ì´ì§€</a>
                </li>
                <li class="nav-item">
                    <c:url value="/user/signout" var="signOutPage"/>
                    <a class="nav-link" href="${signOutPage}">LOGOUT</a>
                </li>
            </c:if>
        </ul>
    </div>
</div>

<!-- ì•Œë¦¼ ëª¨ë‹¬ -->
<div class="modal fade" id="notificationModal" tabindex="-1" aria-labelledby="notificationModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="notificationModalLabel">ì•Œë¦¼</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- ì•Œë¦¼ í•„í„° -->
                <div class="notification-filters">
                    <button class="filter-btn active" data-filter="all">ì „ì²´</button>
                     <button class="filter-btn" data-filter="festival">ğŸ‰ ì¶•ì œ</button>
                    <button class="filter-btn" data-filter="community">ğŸ‘¥ ê³„ì •</button>
               </div>
                
                <!-- ë¹ˆ ìƒíƒœ í‘œì‹œ -->
                <div class="empty-state">
                    <div class="empty-state-icon">
                        <i class="bi bi-bell-slash"></i>
                    </div>
                    <h6>ì•Œë¦¼ì´ ì—†ìŠµë‹ˆë‹¤</h6>
                    <p class="text-muted">ìƒˆë¡œìš´ ì•Œë¦¼ì´ ì˜¤ë©´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤</p>
                </div>

                <!-- ì•Œë¦¼ ëª©ë¡ ì»¨í…Œì´ë„ˆ (í˜„ì¬ëŠ” ìˆ¨ê¹€) -->
                <div class="list-group" id="notificationList" style="display: none;">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">ë‹«ê¸°</button>
                <button type="button" class="btn btn-primary" id="markAllRead" disabled>ëª¨ë“  ì•Œë¦¼ ì½ìŒ</button>
            </div>
        </div>
    </div>
</div>

<!-- ë¡œê·¸ì¸ ëª¨ë‹¬ -->
<div id="signinModal" class="modal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <!-- ìµœìƒë‹¨ ë‹«ê¸° ë²„íŠ¼ -->
            <div class="modal-header">
                <button class="btn-close" data-bs-dismiss="modal" aria-label="close"></button>
            </div>
            <div class="modal-body">
                <!-- ìƒë‹¨ íƒ€ì´í‹€ -->
                <div>
                    <h4 class="text-center">FestGo</h4>
                </div>
                <!-- ì•„ì´ë”” ì…ë ¥ -->
                <div class="form-floating">
                    <input type="text" class="form-control mb-2" 
                        id="modalSigninUsername" placeholder="ì•„ì´ë””" autofocus required />
                    <label for="modalSigninUsername">ì•„ì´ë””</label>
                </div>
                <!-- ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ -->
                <div class="form-floating">
                    <input type="password" class="form-control mb-2" 
                        id="modalSigninPassword" placeholder="ë¹„ë°€ë²ˆí˜¸" required />
                    <label for="modalSigninPassword">ë¹„ë°€ë²ˆí˜¸</label>
                </div>
                <!-- ë¡œê·¸ì¸ ë²„íŠ¼ -->
                <div class="text-danger mb-3" id="warningText"></div>
                <div class="d-grid gap-2 mx-auto">
                    <button class="btn btn-primary btn-lg" id="btnSignin">ë¡œê·¸ì¸</button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Axios Http JS -->
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

<c:url var="signInJS" value="/js/signIn.js" />
<script src="${ signInJS }"></script>

<!-- ì•Œë¦¼ ê´€ë ¨ JavaScript -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // í•„í„° ë²„íŠ¼ ì´ë²¤íŠ¸
    const filterButtons = document.querySelectorAll('.filter-btn');
    filterButtons.forEach(button => {
        button.addEventListener('click', function() {
            // í™œì„± í•„í„° ë³€ê²½
            filterButtons.forEach(btn => btn.classList.remove('active'));
            this.classList.add('active');
            
            // TODO: í•„í„°ë§ ë¡œì§ êµ¬í˜„
        });
    });

    // ì•Œë¦¼ ë°°ì§€ ìƒíƒœ ê´€ë¦¬
    function updateNotificationBadge(count) {
        const badge = document.getElementById('notificationBadge');
        if (count > 0) {
            badge.style.display = 'block';
            badge.textContent = count;
            document.getElementById('markAllRead').disabled = false;
        } else {
            badge.style.display = 'none';
            document.getElementById('markAllRead').disabled = true;
        }
    }

    // ëª¨ë“  ì•Œë¦¼ ì½ìŒ ì²˜ë¦¬
    document.getElementById('markAllRead')?.addEventListener('click', function() {
        // TODO: ì„œë²„ì— ì½ìŒ ì²˜ë¦¬ ìš”ì²­
        updateNotificationBadge(0);
    });

    // ì•Œë¦¼ ëª¨ë‹¬ì´ ì—´ë¦´ ë•Œ ì´ë²¤íŠ¸
    const notificationModal = document.getElementById('notificationModal');
    notificationModal?.addEventListener('show.bs.modal', function() {
        // TODO: ì„œë²„ì—ì„œ ìµœì‹  ì•Œë¦¼ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
    });

    // ë¡œê·¸ì¸ ëª¨ë‹¬ ìë™ ì‹¤í–‰
    const loginRequired = "<c:out value='${loginRequired}'/>";
    if (loginRequired === "true") {
        const linkSignin = document.getElementById("linkSignin");
        linkSignin.click();
    }
});
</script>
