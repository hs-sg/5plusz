<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8" trimDirectiveWhitespaces="true"%>
<%@ taglib prefix="c" uri="jakarta.tags.core"%>

<!-- ì‚¬ìš©ì ì •ì˜ í–„ë²„ê±° ì•„ì´ì½˜ ë° ë²„íŠ¼ ìŠ¤íƒ€ì¼ -->
<style>
    /* ë²„íŠ¼ ìì²´ì˜ ë°°ê²½ê³¼ í…Œë‘ë¦¬ë¥¼ ì œê±° */
    .btn-hamburger {
        background-color: transparent !important;
        border: none !important;
        padding: 0;
    }
    /* ì‚¬ìš©ì ì •ì˜ í–„ë²„ê±° ì•„ì´ì½˜: ì„¸ ê°œì˜ ê²€ì€ìƒ‰ ê°€ë¡œì¤„ */
    .custom-toggler-icon {
        display: inline-block;
        width: 30px;
        height: 24px;
        position: relative;
    }
    .custom-toggler-icon span {
        display: block;
        position: absolute;
        height: 3px;
        width: 100%;
        background: #000;
        border-radius: 2px;
        left: 0;
        transition: all 0.2s;
    }
    .custom-toggler-icon span:nth-child(1) {
        top: 0;
    }
    .custom-toggler-icon span:nth-child(2) {
        top: 10px;
    }
    .custom-toggler-icon span:nth-child(3) {
        top: 20px;
    }
</style>

<!-- Header: ì™¼ìª½ì— Fest Go, ì˜¤ë¥¸ìª½ì— í–„ë²„ê±° ë©”ë‰´ ë²„íŠ¼ -->
<header class="p-3" style="background-color: transparent;">
    <div class="container-fluid d-flex justify-content-between align-items-center">
        <!-- ì™¼ìª½: ë¡œê³  í…ìŠ¤íŠ¸ -->
        <div>
            <c:url value="/" var="homePage"/>
            <a href="${homePage}" class="text-dark text-decoration-none" 
               style="font-size: 2.5rem; font-weight: bold;">
                ğŸ…µğŸ…´ğŸ†‚ğŸ†ƒ ğŸ…¶ğŸ…¾
            </a>
        </div>
        <!-- ì˜¤ë¥¸ìª½: ì‚¬ìš©ì ì •ì˜ í–„ë²„ê±° ë©”ë‰´ ë²„íŠ¼ -->
        <div>
            <button class="btn btn-hamburger" type="button"
                data-bs-toggle="offcanvas" data-bs-target="#offcanvasMenu"
                aria-controls="offcanvasMenu">
                <span class="custom-toggler-icon">
                    <span></span>
                    <span></span>
                    <span></span>
                </span>
            </button>
        </div>
    </div>
</header>


<!-- Offcanvas ë©”ë‰´ (ì˜¤ë¥¸ìª½ì—ì„œ ìŠ¬ë¼ì´ë“œ) -->
<div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasMenu" aria-labelledby="offcanvasMenuLabel">
    <div class="offcanvas-header">
        <c:if test="${ empty signedInUser }">
            <h5 class="offcanvas-title" id="offcanvasMenuLabel">Menu</h5>
        </c:if>
        <c:if test="${ not empty signedInUser }">
            <h5 class="offcanvas-title" id="offcanvasMenuId">ì•ˆë…•í•˜ì„¸ìš”! ${signedInUser }ë‹˜</h5>
        </c:if>
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body">
        <!-- ë‚´ë¹„ê²Œì´ì…˜ í•­ëª© ì „ì²´ -->
        <ul class="nav flex-column">
            <li class="nav-item">
                <c:url value="/" var="homePage"/>
                <a class="nav-link" href="${homePage}">ì „êµ­ì¶•ì œ</a>
            </li>
            <li class="nav-item">
                <c:url value="/fest/cal" var="festCal"/>
                <a class="nav-link" href="${festCal}">ì¶•ì œë‹¬ë ¥</a>
            </li>
            <li class="nav-item">
                <c:url value="/post/list" var="postList"/>
                <a class="nav-link" href="${postList}">ì»¤ë®¤ë‹ˆí‹°</a>
            </li>
                    <c:if test="${memberRole eq 2 || memberRole eq 3}">
	            <li class="nav-item">
                    <c:url value="/fest/create" var="festCreate"/>
                    <a class="nav-link" href="${festCreate}">ì¶•ì œë“±ë¡</a>
	            </li>
                </c:if>
            <!-- ë¡œê·¸ì¸ ìƒíƒœì— ë”°ë¥¸ ë©”ë‰´ í•­ëª© -->
            <c:if test="${ empty signedInUser }">

                <li class="nav-item">
                    <a class="nav-link" href="" id="linkSignin">LOGIN</a>
                </li>
                <li class="nav-item">
                    <c:url value="/user/signup" var="signUpPage"/>
                    <a class="nav-link" href="${signUpPage}">SIGNUP</a>
                </li>
            </c:if>
            <c:if test="${ not empty signedInUser }">
                <li class="nav-item">
                    <c:url value="/user/mypage" var="myPage"/>
                    <a class="nav-link" href="${myPage}">ë§ˆì´í˜ì´ì§€</a>
                </li>
                <li class="nav-item">
                    <c:url value="/user/signout" var="signOutPage"/>
                    <a class="nav-link" href="${signOutPage}">LOGOUT</a>
                </li>
            </c:if>
        </ul>
    </div>
</div>


</nav>

<!-- ë¡œê·¸ì¸ ëª¨ë‹¬ -->
<div id="signinModal" class="modal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <!-- ìµœìƒë‹¨ ë‹«ê¸° ë²„íŠ¼ -->
            <div class="modal-header">
                <button class="btn-close" data-bs-dismiss="modal" aria-label="close"></button>
            </div>
            <div class="modal-body">
                <!-- ìƒë‹¨ íƒ€ì´í‹€ -->
                <div>
                    <h4 class="text-center">FestGo</h4>
                </div>
                <!-- ì•„ì´ë”” ì…ë ¥ -->
                <div class="form-floating">
                    <input type="text" class="form-control mb-2" 
                        id="modalSigninUsername" placeholder="ì•„ì´ë””" autofocus required />
                    <label for="modalSigninUsername">ì•„ì´ë””</label>
                </div>
                <!-- ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ -->
                <div class="form-floating">
                    <input type="password" class="form-control mb-2" 
                        id="modalSigninPassword" placeholder="ë¹„ë°€ë²ˆí˜¸" required />
                    <label for="modalSigninPassword">ë¹„ë°€ë²ˆí˜¸</label>
                </div>
                <!-- ë¡œê·¸ì¸ ë²„íŠ¼ -->
                <div class="text-danger mb-3" id="warningText"></div>
                <div class="d-grid gap-2 mx-auto">
                    <button class="btn btn-primary btn-lg" id="btnSignin">ë¡œê·¸ì¸</button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Axios Http JS -->
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

<c:url var="signInJS" value="/js/signIn.js" />
<script src="${ signInJS }"></script>

<!-- ë¡œê·¸ì¸ ëª¨ë‹¬ ìë™ ì‹¤í–‰ (ë¡œê·¸ì¸ì´ í•„ìš”í•œ ê²½ìš° ê¸€ì“°ê¸°ìš©) 
<script>
document.addEventListener("DOMContentLoaded", () => {
	const loginRequired = "<c:out value='${loginRequired}'/>";
    if (loginRequired === "true") {
        const linkSignin = document.getElementById("linkSignin");
        linkSignin.click();
    }
});
</script>-->
<script>
document.addEventListener("DOMContentLoaded", () => {
    // ë¡œê·¸ì¸ ëª¨ë‹¬ ìë™ ì‹¤í–‰ ì—¬ë¶€ í™•ì¸
    <c:if test="${not empty loginRequired}">
        const signinModal = new bootstrap.Modal(document.getElementById("signinModal"), { backdrop: true });
        signinModal.show();
    </c:if>
});
</script>
