<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.oplusz.festgo.repository.FestivalDao">

    <!-- 새로운 축제 등록 -->
    <insert id="insertFestivals" useGeneratedKeys="true"
        keyProperty="feId" keyColumn="fe_id">
        INSERT INTO festival (
            fe_name, fe_start_date, fe_end_date, lc_id, fe_postcode,
            fe_address, fe_detail_address, fe_extra_address, fe_phone,
            me_sponsor, fe_fee, the_id, fe_contents,
            fe_lat, fe_long, fe_homepage, fe_image_main, fe_poster,
            fe_created_time, fe_modified_time
        )
        VALUES 
        (#{feName}, #{feStartDate}, #{feEndDate}, #{lcId}, #{fePostcode}, #{feAddress}, #{feDetailAddress}, #{feExtraAddress},
         #{fePhone}, #{meSponsor}, #{feFee}, #{theId}, #{feContents}, #{feLat, jdbcType=VARCHAR}, #{feLong, jdbcType=VARCHAR},
         #{feHomepage}, #{feImageMain}, #{fePoster},
         SYSTIMESTAMP, SYSTIMESTAMP)
    </insert>
    
    <!-- 새로운 축제 등록 시 다중 이미지 처리 -->
    <insert id="insertFestivalImagesBatch">
        INSERT INTO festival_image (fe_id, fi_images)
        VALUES
        <foreach collection="festivalImages" item="image" separator=",">
            (#{image.feId}, #{image.fiImages})
        </foreach>
    </insert>

    <!-- 특정 기간 내 축제 데이터 조회 -->
    <select id="findFestivalsBetween" resultType="com.oplusz.festgo.dto.FestivalCalendarDto">
        SELECT 
            fe_id AS feId,
            fe_name AS feName,
            TO_CHAR(fe_start_date, 'YYYY-MM-DD') AS feStartDate,
            TO_CHAR(fe_end_date, 'YYYY-MM-DD') AS feEndDate,
            fe_contents AS feContents,
            fe_image_main AS feImageMain,
            fe_detail_address AS feDetailAddress
        FROM festival
        WHERE fe_start_date &lt;= TO_DATE(#{endDate}, 'YYYY-MM-DD')
          AND fe_end_date &gt;= TO_DATE(#{startDate}, 'YYYY-MM-DD')
    </select>

</mapper>
